
-- Таблица художника
CREATE TABLE IF NOT EXISTS artist (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Уникальный идентификатор художника
    artist_name TEXT CONSTRAINT name_length CHECK (LENGTH(artist_name) <= 100) NOT NULL UNIQUE, -- Имя художника
    birth_date DATE NOT NULL, -- Дата рождения художника
    death_date DATE -- Дата смерти художника
);

-- Таблица художественного произведения
CREATE TABLE IF NOT EXISTS artwork (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Уникальный идентификатор произведения искусства
    title TEXT CONSTRAINT title_length CHECK (LENGTH(title) <= 150) NOT NULL, -- Название произведения искусства
    artist_id INT REFERENCES artist(id) ON DELETE CASCADE NOT NULL, -- Идентификатор художника, создавшего произведение
    price_main INT CHECK (price_main >= 0) NOT NULL, -- Основная часть цены произведения искусства
    price_fraction INT CHECK (price_fraction >= 0 AND price_fraction < 100) DEFAULT 0 NOT NULL, -- Дробная часть цены произведения искусства
	quantity INT CHECK (quantity >= 0) DEFAULT 0 NOT NULL -- Количество единиц произведения искусства на складе
);

ALTER TABLE artwork ADD CONSTRAINT unique_title UNIQUE (title);


-- Таблица жанров
CREATE TABLE IF NOT EXISTS genre (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Уникальный идентификатор жанра
    genre_name TEXT CONSTRAINT genre_name_length CHECK (LENGTH(genre_name) <= 100) NOT NULL UNIQUE -- Название жанра
);

-- Таблица для связи многие-ко-многим между произведениями искусства и жанрами
CREATE TABLE IF NOT EXISTS artwork_genre (
    artwork_id INT REFERENCES artwork(id) ON DELETE CASCADE NOT NULL, -- Идентификатор произведения искусства
    genre_id INT REFERENCES genre(id) ON DELETE CASCADE NOT NULL, -- Идентификатор жанра
    PRIMARY KEY (artwork_id, genre_id) -- Комбинация artwork_id и genre_id должна быть уникальной
);

-- Таблица адреса
CREATE TABLE IF NOT EXISTS address (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Уникальный идентификатор адреса
    street TEXT CONSTRAINT street_length CHECK (LENGTH(street) <= 100) NOT NULL, -- Улица адреса
    city TEXT CONSTRAINT city_length CHECK (LENGTH(city) <= 50) NOT NULL, -- Город адреса
    region TEXT CONSTRAINT region_length CHECK (LENGTH(region) <= 50) NOT NULL, -- Штат или область адреса
    country TEXT CONSTRAINT country_length CHECK (LENGTH(country) <= 50) NOT NULL, -- Страна адреса
    zip_code TEXT CONSTRAINT zip_length CHECK (LENGTH(zip_code) <= 10) NOT NULL -- Почтовый индекс адреса
);

-- Таблица персоны
CREATE TABLE IF NOT EXISTS person (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Уникальный идентификатор персоны
    person_name TEXT CONSTRAINT person_name_length CHECK (LENGTH(person_name) <= 100) NOT NULL, -- Имя персоны
    email TEXT CONSTRAINT email_length CHECK (LENGTH(email) <= 100) NOT NULL UNIQUE, -- Электронная почта персоны
    address_id INT REFERENCES address(id) ON DELETE CASCADE NOT NULL -- Идентификатор адреса персоны
);

-- Таблица клиента
CREATE TABLE IF NOT EXISTS customer (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Уникальный идентификатор клиента
    person_id INT REFERENCES person(id) ON DELETE CASCADE NOT NULL, -- Идентификатор персоны, связанной с клиентом
    password TEXT CONSTRAINT password_length CHECK (LENGTH(password) <= 20) NOT NULL -- Пароль клиента
);

-- Таблица поставщика
CREATE TABLE IF NOT EXISTS supplier (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Уникальный идентификатор поставщика
    company_name TEXT CONSTRAINT company_name_length CHECK (LENGTH(company_name) <= 100) NOT NULL UNIQUE -- Название компании поставщика
);

ALTER TABLE supplier ADD COLUMN about TEXT CHECK (LENGTH(about) <= 150);


-- Таблица операции и оплаты
CREATE TABLE IF NOT EXISTS operation (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Уникальный идентификатор операции
    artwork_id INT REFERENCES artwork(id) ON DELETE CASCADE NOT NULL, -- Идентификатор произведения искусства, связанного с операцией
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP NOT NULL, -- Дата операции
    amount_main INT CHECK (amount_main >= 0) NOT NULL, -- Основная часть суммы оплаты
    amount_fraction INT CHECK (amount_fraction >= 0 AND amount_fraction < 100) DEFAULT 0 NOT NULL, -- Дробная часть суммы оплаты
	quantity INT CHECK (quantity >= 0) DEFAULT 0 NOT NULL -- Количество единиц произведения искусства на складе
);

-- Таблица продажи
CREATE TABLE IF NOT EXISTS sale (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Уникальный идентификатор продажи
    operation_id INT REFERENCES operation(id) ON DELETE CASCADE NOT NULL, -- Идентификатор операции, связанной с продажей
    customer_id INT REFERENCES customer(id) ON DELETE CASCADE NOT NULL -- Идентификатор клиента, связанного с продажей
);

-- Таблица покупки
CREATE TABLE IF NOT EXISTS purchase (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Уникальный идентификатор покупки
    operation_id INT REFERENCES operation(id) ON DELETE CASCADE NOT NULL, -- Идентификатор операции, связанной с покупкой
    supplier_id INT REFERENCES supplier(id) ON DELETE CASCADE NOT NULL -- Идентификатор поставщика, связанного с покупкой
);

CREATE TABLE IF NOT EXISTS reviews (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Уникальный идентификатор отзыва
    customer_id INT REFERENCES customer(id) ON DELETE CASCADE NOT NULL, -- Идентификатор клиента, оставившего отзыв
    artwork_id INT REFERENCES artwork(id) ON DELETE CASCADE NOT NULL, -- Идентификатор произведения искусства, на которое оставлен отзыв
    rating INT CHECK (rating >= 1 AND rating <= 10) NOT NULL, -- Оценка от 1 до 10
    review_text TEXT, -- Текст отзыва
    review_date TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP NOT NULL, -- Дата и время отзыва
    UNIQUE (customer_id, artwork_id) -- Каждый клиент может оставить только один отзыв на каждое произведение искусства
);


CREATE INDEX idx_genre_genre_name ON genre USING btree(genre_name);

CREATE INDEX idx_artist_name_alphabetical ON artist USING btree(artist_name text_pattern_ops);


-- Вставка записей в таблицу artist
INSERT INTO artist (artist_name, birth_date, death_date)
VALUES 
('Пабло Пикассо', '1881-10-25', '1973-04-08'),
('Винсент ван Гог', '1853-03-30', '1890-07-29'),
('Клод Моне', '1840-11-14', '1926-12-05'),
('Рембрандт', '1606-07-15', '1669-10-04'),
('Леонардо да Винчи', '1452-04-15', '1519-05-02'),
('Михаэль Анджело', '1475-03-06', '1564-02-18'),
('Джексон Поллок', '1912-01-28', '1956-08-11'),
('Йоханнес Вермер', '1632-10-31', '1675-12-15'),
('Энди Ворхол', '1928-08-06', '1987-02-22'),
('Джорджия О Кифф', '1887-11-15', '1986-03-06'),
('Франсиско Гойя', '1746-03-10', '1828-04-16'),
('Эдуард Мане', '1832-01-23', '1883-04-28'),
('Жан-Франсуа Милле', '1814-04-04', '1875-01-26');

-- Вставка записей в таблицу произведение искусства (artwork)
INSERT INTO artwork (title, artist_id, price_main, price_fraction, quantity)
VALUES 
('Звёздная ночь', 2, 100, 0, 1),
('Герника', 1, 200, 0, 1),
('Вода лилий', 3, 150, 0, 1),
('Ночной дозор', 4, 180, 0, 1),
('Мона Лиза', 5, 250, 0, 1),
('Последний суд', 6, 220, 0, 1),
('№ 5, 1948', 7, 140, 0, 1),
('Девушка с жемчужной серьёгой', 8, 160, 0, 1),
('Канцлерские супы', 9, 130, 0, 1),
('Черная ирис III', 10, 120, 0, 1),
('Олимпия', 11, 300, 0, 1),
('Сонеты к Аретине', 12, 275, 0, 1),
('Автопортрет', 13, 90, 0, 1);

-- Вставка записей в таблицу жанры (genre)
INSERT INTO genre (genre_name)
VALUES 
('Импрессионизм'),
('Кубизм'),
('Пост-импрессионизм'),
('Барокко'),
('Ренессанс'),
('Высокий Ренессанс'),
('Абстрактное выражение'),
('Золотой век Голландии'),
('Поп-арт'),
('Американское модернизм');

-- Вставка связей между произведениями искусства и жанрами в таблицу artwork_genre
INSERT INTO artwork_genre (artwork_id, genre_id)
VALUES 
(1, 2), -- Звёздная ночь - Кубизм
(2, 1), -- Герника - Импрессионизм
(3, 3), -- Вода лилий - Пост-импрессионизм
(4, 4), -- Ночной дозор - Барокко
(5, 5), -- Мона Лиза - Ренессанс
(6, 6), -- Последний суд - Высокий Ренессанс
(7, 7), -- № 5, 1948 - Абстрактное выражение
(8, 8), -- Девушка с жемчужной серьёгой - Золотой век Голландии
(9, 9), -- Канцлерские супы - Поп-арт
(10, 10), -- Черная ирис III - Американское модернизм
(11, 2), -- Олимпия - Кубизм
(12, 1), -- Сонеты к Аретине - Импрессионизм
(13, 7); -- Автопортрет - Абстрактное выражение


 
-- Вставка данных в таблицу адреса
INSERT INTO address (street, city, region, country, zip_code)
VALUES
('Московская улица', 'Москва', 'Московская область', 'Россия', '101000'),
('Ленина проспект', 'Санкт-Петербург', 'Санкт-Петербург', 'Россия', '190000'),
('Кирова улица', 'Нижний Новгород', 'Нижегородская область', 'Россия', '606000'),
('Пушкина улица', 'Казань', 'Татарстан', 'Россия', '420000'),
('Гагарина проспект', 'Воронеж', 'Воронежская область', 'Россия', '396000'),
('Льва Толстого улица', 'Ярославль', 'Ярославская область', 'Россия', '150000'),
('Дзержинского улица', 'Иваново', 'Ивановская область', 'Россия', '153000'),
('Советская улица', 'Уфа', 'Башкортостан', 'Россия', '450000'),
('Октябрьская улица', 'Пермь', 'Пермский край', 'Россия', '614000'),
('Комсомольская улица', 'Челябинск', 'Челябинская область', 'Россия', '454000'),
('Победы улица', 'Самара', 'Самарская область', 'Россия', '443000'),
('Калинина улица', 'Кемерово', 'Кемеровская область', 'Россия', '650000'),
('Свердлова улица', 'Екатеринбург', 'Свердловская область', 'Россия', '620000'),
('Фрунзе улица', 'Набережные Челны', 'Татарстан', 'Россия', '423000'),
('Куйбышева улица', 'Киров', 'Кировская область', 'Россия', '610000'),
('Сталинградская улица', 'Волжский', 'Волгоградская область', 'Россия', '404000'),
('Красноярский проспект', 'Курск', 'Курская область', 'Россия', '305000'),
('Алтайская улица', 'Бийск', 'Алтайский край', 'Россия', '659700'),
('Цюрихская улица', 'Химки', 'Московская область', 'Россия', '141000');

-- Вставка данных в таблицу персоны
INSERT INTO person (person_name, email, address_id)
VALUES
('Иван Иванов', 'ivanov@example.com', 1),
('Анна Петрова', 'petrova@example.com', 2),
('Сергей Сидоров', 'sidorov@example.com', 3),
('Мария Фёдорова', 'fedorova@example.com', 4),
('Дмитрий Худяков', 'hudjakov@example.com', 5),
('Наталья Цветкова', 'tsvetkova@example.com', 6),
('Алексей Щербаков', 'shcherbakov@example.com', 7),
('Елена Юдинова', 'yudinova@example.com', 8),
('Владимир Яковлев', 'yakovlev@example.com', 9),
('Ольга Зайцева', 'zaytseva@example.com', 10),
('Александр Кузнецов', 'kuznetsov@example.com', 11),
('Николай Лебедев', 'lebedev@example.com', 12),
('Мария Миронова', 'mironova@example.com', 13),
('Василий Никифоров', 'nikiforov@example.com', 14),
('Светлана Овчинникова', 'ovchinnikova@example.com', 15),
('Данила Пупкин', 'pupkin@example.com', 16),
('Екатерина Романова', 'romanova@example.com', 17),
('Виктор Смирнов', 'smirnov@example.com', 18),
('Татьяна Федоренко', 'fedorenko@example.com', 19);


-- Вставка данных в таблицу клиента
INSERT INTO customer (person_id, password)
VALUES
(1, 'password1'),
(2, 'password2'),
(3, 'password3'),
(4, 'password4'),
(5, 'password5'),
(6, 'password6'),
(7, 'password7'),
(8, 'password8'),
(9, 'password9'),
(10, 'password10'),
(11, 'password11'),
(12, 'password12'),
(13, 'password13'),
(14, 'password14'),
(15, 'password15'),
(16, 'password16'),
(17, 'password17'),
(18, 'password18'),
(19, 'password19');

-- Вставка данных в таблицу поставщика
INSERT INTO supplier (company_name, about)
VALUES
('ООО Квадратные миры', 'Специализируются на продаже абстрактного искусства'),
('ЗАО Золотое руно', 'Специализируются на ренессансных и барочных произведениях'),
('ООО Палитра', 'Специализируются на импрессионистских и пост-импрессионистских работах'),
('ООО Мастерские', 'Предлагают работы современных художников и скульпторов'),
('ЗАО Культурный артефакт', 'Специализируются на антикварном искусстве и редких коллекциях'),
('ООО Импровизация', 'Организация, предлагающая уникальные произведения современного искусства, созданные в процессе живых выступлений'),
('ООО Эхо времен', 'Специализируются на исторических репродукциях и копиях знаменитых произведений'),
('ЗАО Свет и тень', 'Предоставляют услуги по созданию и установке световых инсталляций в пространствах искусства'),
('ООО Голоса прошлого', 'Специализируются на воссоздании эпохи Возрождения через реконструкции интерьеров и декораций');

select * from supplier;

INSERT INTO operation (artwork_id, amount_main, amount_fraction, quantity)
VALUES 
(1, 15000, 0, 5),
(2, 20000, 0, 3),
(3, 25000, 0, 2),
(4, 30000, 0, 1),
(5, 35000, 0, 0),
(6, 40000, 0, 7),
(7, 45000, 0, 8),
(8, 50000, 0, 9),
(9, 55000, 0, 10),
(10, 60000, 0, 11);

    
INSERT INTO sale (operation_id, customer_id)
VALUES 
(1, 1),
(2, 2),
(3, 3),
(4, 4),
(5, 5),
(6, 6),
(7, 7),
(8, 8),
(9, 9),
(10, 10);


INSERT INTO purchase (operation_id, supplier_id)
VALUES 
(1, 10),
(2, 11),
(3, 12),
(4, 13),
(5, 14),
(6, 15),
(7, 16),
(8, 17);

INSERT INTO reviews (customer_id, artwork_id, rating, review_text, review_date)
VALUES 
(1, 1, 10, 'Это произведение искусства просто потрясающее Оно заставляет задуматься и чувствовать.', CURRENT_TIMESTAMP),
(2, 2, 8, 'Хорошая картина, но мне кажется, она могла быть лучше.', CURRENT_TIMESTAMP),
(3, 3, 7, 'Интересное произведение, но оно не привлекло меня таким образом, как я ожидал.', CURRENT_TIMESTAMP),
(4, 4, 4, 'Я не понимаю, почему эта картина считается великим шедевром.', CURRENT_TIMESTAMP),
(5, 5, 4, 'Не могу сказать, что мне понравилось.', CURRENT_TIMESTAMP),
(6, 6, 8, 'Эта картина заставила меня почувствовать себя в другой реальности.', CURRENT_TIMESTAMP),
(7, 7, 10, 'Картину можно оценить, если знать контекст её создания.', CURRENT_TIMESTAMP),
(8, 8, 8, 'Произведение интересное, но не захватывающее.', CURRENT_TIMESTAMP),
(9, 9, 4, 'Картину можно пропустить, если не увлекаетесь этим жанром.', CURRENT_TIMESTAMP),
(10, 10, 1, 'Не понравилось, слишком абстрактно.', CURRENT_TIMESTAMP);


